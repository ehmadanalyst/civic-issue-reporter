<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Civic Issue Reporter & Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 968px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .upload-zone {
            border: 3px dashed #667eea;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
            position: relative;
        }

        .upload-zone:hover {
            border-color: #764ba2;
            background: #f8f9ff;
        }

        .upload-zone.dragover {
            background: #f0f3ff;
            border-color: #764ba2;
        }

        .upload-zone img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .upload-icon {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 10px;
        }

        input[type="file"] {
            display: none;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            min-height: 100px;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .voice-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            align-items: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
            justify-content: center;
            font-size: 1.1rem;
            padding: 15px;
            margin-top: 20px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-voice {
            background: #f0f0f0;
            color: #333;
            flex: 1;
        }

        .btn-voice:hover {
            background: #e0e0e0;
        }

        .btn-voice.recording {
            background: #ff4444;
            color: white;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .result-card {
            margin-top: 20px;
        }

        .severity-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .severity-critical {
            background: #ff4444;
            color: white;
        }

        .severity-high {
            background: #ff9800;
            color: white;
        }

        .severity-medium {
            background: #ffd700;
            color: #333;
        }

        .severity-low {
            background: #4caf50;
            color: white;
        }

        .info-section {
            margin-bottom: 20px;
        }

        .info-section h3 {
            color: #667eea;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .info-section p, .info-section ul {
            color: #555;
            line-height: 1.6;
        }

        .info-section ul {
            margin-left: 20px;
        }

        .json-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            max-height: 500px;
            overflow-y: auto;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .example-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-top: 30px;
        }

        .example-section h2 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .example-card {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .example-card:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .example-card h4 {
            color: #333;
            margin-bottom: 8px;
        }

        .example-card p {
            color: #666;
            font-size: 0.9rem;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-info {
            background: #e3f2fd;
            color: #1976d2;
            border-left: 4px solid #1976d2;
        }

        .download-btn {
            background: #4caf50;
            color: white;
            margin-top: 10px;
        }

        .download-btn:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåü Civic Issue Reporter & Analyzer</h1>
            <p>AI-powered platform for reporting and analyzing civic infrastructure problems</p>
        </div>

        <div class="alert alert-info">
            <strong>üì± How it works:</strong> Upload a photo of the problem, describe it (type or voice), and our AI will analyze it, classify severity, and generate a structured report for authorities.
        </div>

        <div class="main-content">
            <!-- Input Section -->
            <div class="card">
                <h2>üì∏ Report an Issue</h2>
                
                <div class="upload-zone" id="uploadZone">
                    <div class="upload-icon">üì∑</div>
                    <p><strong>Click to upload</strong> or drag and drop an image</p>
                    <p style="color: #999; font-size: 0.9rem; margin-top: 5px;">PNG, JPG, WEBP up to 10MB</p>
                    <input type="file" id="fileInput" accept="image/*">
                    <img id="previewImage" style="display: none;">
                </div>

                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                    Describe the issue:
                </label>
                <textarea 
                    id="issueDescription" 
                    placeholder="E.g., Large pothole on Main Street causing traffic hazard..."
                ></textarea>

                <div class="voice-controls">
                    <button class="btn btn-voice" id="recordBtn">
                        üé§ Record Voice
                    </button>
                    <span id="recordingStatus" style="font-size: 0.9rem; color: #666;"></span>
                </div>

                <button class="btn btn-primary" id="analyzeBtn" disabled>
                    üîç Analyze Issue
                </button>
            </div>

            <!-- Results Section -->
            <div class="card">
                <h2>üìä AI Analysis Results</h2>
                <div id="resultsContainer">
                    <p style="color: #999; text-align: center; padding: 40px;">
                        Upload an image and description to see AI analysis results
                    </p>
                </div>
            </div>
        </div>

        <!-- Examples Section -->
        <div class="example-section">
            <h2>üí° Example Use Cases (Pakistan Context)</h2>
            <div class="examples">
                <div class="example-card" onclick="loadExample('pothole')">
                    <h4>üöß Road Damage</h4>
                    <p>Potholes in Lahore causing vehicle damage and traffic issues</p>
                </div>
                <div class="example-card" onclick="loadExample('water')">
                    <h4>üíß Water Leak</h4>
                    <p>Major water line burst in Karachi neighborhood</p>
                </div>
                <div class="example-card" onclick="loadExample('streetlight')">
                    <h4>üí° Broken Streetlight</h4>
                    <p>Non-functional streetlight in Islamabad creating safety hazard</p>
                </div>
                <div class="example-card" onclick="loadExample('garbage')">
                    <h4>üóëÔ∏è Garbage Accumulation</h4>
                    <p>Uncollected waste pile in residential area</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let imageData = null;
        let isRecording = false;
        let mediaRecorder = null;
        let audioChunks = [];

        // File upload handling
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');
        const previewImage = document.getElementById('previewImage');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const issueDescription = document.getElementById('issueDescription');

        uploadZone.addEventListener('click', () => fileInput.click());

        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                handleImageUpload(file);
            }
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                handleImageUpload(file);
            }
        });

        function handleImageUpload(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                imageData = e.target.result;
                previewImage.src = imageData;
                previewImage.style.display = 'block';
                uploadZone.querySelector('.upload-icon').style.display = 'none';
                uploadZone.querySelector('p').style.display = 'none';
                checkEnableAnalyze();
            };
            reader.readAsDataURL(file);
        }

        function checkEnableAnalyze() {
            analyzeBtn.disabled = !(imageData || issueDescription.value.trim());
        }

        issueDescription.addEventListener('input', checkEnableAnalyze);

        // Voice recording
        const recordBtn = document.getElementById('recordBtn');
        const recordingStatus = document.getElementById('recordingStatus');

        recordBtn.addEventListener('click', toggleRecording);

        async function toggleRecording() {
            if (!isRecording) {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];

                    mediaRecorder.ondataavailable = (event) => {
                        audioChunks.push(event.data);
                    };

                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        // In a real implementation, you'd send this to a speech-to-text API
                        recordingStatus.textContent = 'Recording saved (in demo, type instead)';
                        stream.getTracks().forEach(track => track.stop());
                    };

                    mediaRecorder.start();
                    isRecording = true;
                    recordBtn.classList.add('recording');
                    recordBtn.textContent = '‚èπÔ∏è Stop Recording';
                    recordingStatus.textContent = 'Recording...';
                } catch (err) {
                    alert('Microphone access denied. Please type your description instead.');
                }
            } else {
                mediaRecorder.stop();
                isRecording = false;
                recordBtn.classList.remove('recording');
                recordBtn.textContent = 'üé§ Record Voice';
            }
        }

        // Analyze button
        analyzeBtn.addEventListener('click', analyzeIssue);

        async function analyzeIssue() {
            const description = issueDescription.value.trim();
            
            if (!imageData && !description) {
                alert('Please upload an image or provide a description');
                return;
            }

            analyzeBtn.disabled = true;
            analyzeBtn.textContent = 'üîÑ Analyzing...';
            
            showLoading();

            try {
                // In a real implementation, this would call your backend API
                // which would then call Gemini/Claude API
                // For demo, we'll simulate AI analysis
                await simulateAIAnalysis(description);
            } catch (error) {
                showError(error.message);
            } finally {
                analyzeBtn.disabled = false;
                analyzeBtn.textContent = 'üîç Analyze Issue';
            }
        }

        function showLoading() {
            const resultsContainer = document.getElementById('resultsContainer');
            resultsContainer.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>AI is analyzing the issue...</p>
                </div>
            `;
        }

        async function simulateAIAnalysis(description) {
            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 2000));

            // Mock AI analysis based on description keywords
            const analysis = generateMockAnalysis(description);
            displayResults(analysis);
        }

        function generateMockAnalysis(description) {
            const lowerDesc = description.toLowerCase();
            
            let issueType = 'General Infrastructure';
            let severity = 'medium';
            let urgency = 'Monitor within 48 hours';
            let solutions = [];
            let safetyWarnings = [];

            // Classify issue type
            if (lowerDesc.includes('pothole') || lowerDesc.includes('road') || lowerDesc.includes('crack')) {
                issueType = 'Road Infrastructure';
                severity = 'high';
                urgency = 'Immediate attention required';
                solutions = [
                    'Deploy road repair crew within 24 hours',
                    'Install temporary warning signs',
                    'Schedule asphalt patching',
                    'Conduct structural assessment of surrounding area'
                ];
                safetyWarnings = ['Vehicle damage risk', 'Accident potential during rain'];
            } else if (lowerDesc.includes('water') || lowerDesc.includes('leak') || lowerDesc.includes('pipe')) {
                issueType = 'Water & Sanitation';
                severity = 'critical';
                urgency = 'Emergency - Immediate response';
                solutions = [
                    'Emergency plumbing team dispatch',
                    'Shut off main water valve in affected area',
                    'Assess extent of water damage',
                    'Coordinate with WASA for permanent fix'
                ];
                safetyWarnings = ['Water contamination risk', 'Structural damage to nearby buildings'];
            } else if (lowerDesc.includes('light') || lowerDesc.includes('electricity') || lowerDesc.includes('dark')) {
                issueType = 'Electrical Infrastructure';
                severity = 'high';
                urgency = 'Priority - within 12 hours';
                solutions = [
                    'Send electrician team for inspection',
                    'Replace faulty bulbs/fixtures',
                    'Check electrical connections',
                    'Install temporary lighting if needed'
                ];
                safetyWarnings = ['Increased crime risk', 'Pedestrian safety hazard at night'];
            } else if (lowerDesc.includes('garbage') || lowerDesc.includes('waste') || lowerDesc.includes('trash')) {
                issueType = 'Sanitation & Waste';
                severity = 'medium';
                urgency = 'Schedule within 24 hours';
                solutions = [
                    'Deploy waste collection team',
                    'Sanitize affected area',
                    'Investigate collection schedule gaps',
                    'Set up additional bins if needed'
                ];
                safetyWarnings = ['Health hazard', 'Pest infestation risk'];
            }

            // Generate JSON report
            const jsonReport = {
                report_id: 'CIV-' + Date.now(),
                timestamp: new Date().toISOString(),
                issue_classification: {
                    type: issueType,
                    severity: severity,
                    urgency: urgency
                },
                location: {
                    description: description.substring(0, 100),
                    coordinates: null // Would be extracted from image metadata or user input
                },
                ai_analysis: {
                    detected_elements: imageData ? ['Visual damage confirmation'] : ['Text description only'],
                    risk_level: severity,
                    estimated_impact: severity === 'critical' ? 'High - affects multiple residents' : 
                                     severity === 'high' ? 'Medium - localized disruption' : 'Low - minor inconvenience'
                },
                recommended_actions: solutions,
                safety_warnings: safetyWarnings,
                priority_score: severity === 'critical' ? 95 : 
                               severity === 'high' ? 75 : 
                               severity === 'medium' ? 50 : 25,
                assigned_department: issueType.includes('Road') ? 'Public Works - Roads Division' :
                                    issueType.includes('Water') ? 'Water & Sanitation Authority (WASA)' :
                                    issueType.includes('Electrical') ? 'Electrical Services Department' :
                                    'Municipal Services',
                citizen_description: description
            };

            return {
                type: issueType,
                severity: severity,
                urgency: urgency,
                solutions: solutions,
                warnings: safetyWarnings,
                json: jsonReport
            };
        }

        function displayResults(analysis) {
            const resultsContainer = document.getElementById('resultsContainer');
            
            const severityClass = `severity-${analysis.severity}`;
            const severityText = analysis.severity.toUpperCase();

            resultsContainer.innerHTML = `
                <div class="result-card">
                    <div class="severity-badge ${severityClass}">
                        ${severityText} SEVERITY
                    </div>

                    <div class="info-section">
                        <h3>üìã Issue Classification</h3>
                        <p><strong>Type:</strong> ${analysis.type}</p>
                        <p><strong>Urgency:</strong> ${analysis.urgency}</p>
                    </div>

                    <div class="info-section">
                        <h3>‚ö†Ô∏è Safety Warnings</h3>
                        <ul>
                            ${analysis.warnings.map(w => `<li>${w}</li>`).join('')}
                        </ul>
                    </div>

                    <div class="info-section">
                        <h3>‚úÖ Recommended Actions</h3>
                        <ul>
                            ${analysis.solutions.map(s => `<li>${s}</li>`).join('')}
                        </ul>
                    </div>

                    <div class="info-section">
                        <h3>üìÑ Government Dashboard Report (JSON)</h3>
                        <div class="json-output">${JSON.stringify(analysis.json, null, 2)}</div>
                        <button class="btn download-btn" onclick="downloadReport()">
                            üì• Download JSON Report
                        </button>
                    </div>
                </div>
            `;

            // Store for download
            window.currentReport = analysis.json;
        }

        function downloadReport() {
            if (!window.currentReport) return;
            
            const dataStr = JSON.stringify(window.currentReport, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `civic_report_${window.currentReport.report_id}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function showError(message) {
            const resultsContainer = document.getElementById('resultsContainer');
            resultsContainer.innerHTML = `
                <div style="padding: 20px; text-align: center; color: #d32f2f;">
                    <p><strong>Error:</strong> ${message}</p>
                    <p style="margin-top: 10px; font-size: 0.9rem;">Please try again</p>
                </div>
            `;
        }

        // Example loading
        function loadExample(type) {
            const examples = {
                pothole: 'Large pothole on Main Street near Mall Road, Lahore. The hole is approximately 2 feet deep and causing severe traffic disruption. Multiple vehicles have been damaged.',
                water: 'Major water line burst on Shahrah-e-Faisal, Karachi. Water flooding the street and entering nearby shops. Emergency situation affecting 50+ households.',
                streetlight: 'Streetlight at F-6 Markaz, Islamabad has been non-functional for 3 days. Creating safety hazard for pedestrians at night. Area completely dark.',
                garbage: 'Uncollected garbage pile in Model Town, Lahore for past 5 days. Foul smell and flies attracting rats. Health hazard for residents.'
            };

            issueDescription.value = examples[type] || '';
            checkEnableAnalyze();
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
